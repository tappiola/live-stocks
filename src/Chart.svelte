<script>
    // import chartjs from 'chart.js';
    import Line from "svelte-chartjs/src/Line.svelte"
    import 'chartjs-adapter-date-fns';
    // let chartData;
    import { onMount } from 'svelte';

    const TIME_SERIES_5MIN = 'Time Series (5min)';
    // let chartValues = [20, 10, 5, 2, 20, 30, 45];
    // let chartLabels = ['January', 'February', 'March', 'April', 'May', 'June', 'July'];

    let data = {
        "Meta Data": {
            "1. Information": "Intraday (5min) open, high, low, close prices and volume",
            "2. Symbol": "EL",
            "3. Last Refreshed": "2022-01-19 18:05:00",
            "4. Interval": "5min",
            "5. Output Size": "Compact",
            "6. Time Zone": "US/Eastern"
        },
        "Time Series (5min)": {
            "2022-01-19 18:05:00": {
                "1. open": "309.0000",
                "2. high": "309.0000",
                "3. low": "309.0000",
                "4. close": "309.0000",
                "5. volume": "783"
            },
            "2022-01-19 16:40:00": {
                "1. open": "309.5200",
                "2. high": "309.5200",
                "3. low": "309.5200",
                "4. close": "309.5200",
                "5. volume": "319"
            },
            "2022-01-19 16:35:00": {
                "1. open": "309.5200",
                "2. high": "309.5200",
                "3. low": "309.5200",
                "4. close": "309.5200",
                "5. volume": "17700"
            },
            "2022-01-19 16:15:00": {
                "1. open": "309.5200",
                "2. high": "309.5200",
                "3. low": "309.5200",
                "4. close": "309.5200",
                "5. volume": "1059"
            },
            "2022-01-19 16:10:00": {
                "1. open": "309.5200",
                "2. high": "309.5200",
                "3. low": "309.5200",
                "4. close": "309.5200",
                "5. volume": "102"
            },
            "2022-01-19 16:05:00": {
                "1. open": "309.5200",
                "2. high": "309.5200",
                "3. low": "309.5200",
                "4. close": "309.5200",
                "5. volume": "20924"
            },
            "2022-01-19 16:00:00": {
                "1. open": "309.9100",
                "2. high": "310.0100",
                "3. low": "309.0100",
                "4. close": "309.6200",
                "5. volume": "125877"
            },
            "2022-01-19 15:55:00": {
                "1. open": "310.9200",
                "2. high": "311.0600",
                "3. low": "309.8300",
                "4. close": "309.9750",
                "5. volume": "76127"
            },
            "2022-01-19 15:50:00": {
                "1. open": "311.0750",
                "2. high": "311.3650",
                "3. low": "310.9200",
                "4. close": "310.9200",
                "5. volume": "46504"
            },
            "2022-01-19 15:45:00": {
                "1. open": "310.9000",
                "2. high": "311.1900",
                "3. low": "310.7100",
                "4. close": "311.1300",
                "5. volume": "32503"
            },
            "2022-01-19 15:40:00": {
                "1. open": "311.0000",
                "2. high": "311.3700",
                "3. low": "310.7900",
                "4. close": "310.9200",
                "5. volume": "35954"
            },
            "2022-01-19 15:35:00": {
                "1. open": "311.1300",
                "2. high": "311.1600",
                "3. low": "310.6800",
                "4. close": "311.0700",
                "5. volume": "31934"
            },
            "2022-01-19 15:30:00": {
                "1. open": "311.6600",
                "2. high": "311.7750",
                "3. low": "311.0800",
                "4. close": "311.2000",
                "5. volume": "19231"
            },
            "2022-01-19 15:25:00": {
                "1. open": "311.7900",
                "2. high": "311.8200",
                "3. low": "311.4200",
                "4. close": "311.5550",
                "5. volume": "23255"
            },
            "2022-01-19 15:20:00": {
                "1. open": "312.1900",
                "2. high": "312.4350",
                "3. low": "311.5400",
                "4. close": "311.6600",
                "5. volume": "24717"
            },
            "2022-01-19 15:15:00": {
                "1. open": "312.2700",
                "2. high": "312.4700",
                "3. low": "312.0300",
                "4. close": "312.2600",
                "5. volume": "25205"
            },
            "2022-01-19 15:10:00": {
                "1. open": "312.5600",
                "2. high": "312.8500",
                "3. low": "312.1200",
                "4. close": "312.2200",
                "5. volume": "19082"
            },
            "2022-01-19 15:05:00": {
                "1. open": "312.7200",
                "2. high": "312.9300",
                "3. low": "312.2600",
                "4. close": "312.4850",
                "5. volume": "16134"
            },
            "2022-01-19 15:00:00": {
                "1. open": "312.6600",
                "2. high": "313.1300",
                "3. low": "312.5350",
                "4. close": "312.7600",
                "5. volume": "17005"
            },
            "2022-01-19 14:55:00": {
                "1. open": "312.6700",
                "2. high": "312.9000",
                "3. low": "312.2100",
                "4. close": "312.5900",
                "5. volume": "16650"
            },
            "2022-01-19 14:50:00": {
                "1. open": "313.5800",
                "2. high": "313.6550",
                "3. low": "312.5900",
                "4. close": "312.6600",
                "5. volume": "25567"
            },
            "2022-01-19 14:45:00": {
                "1. open": "313.0400",
                "2. high": "313.6300",
                "3. low": "313.0100",
                "4. close": "313.5600",
                "5. volume": "18699"
            },
            "2022-01-19 14:40:00": {
                "1. open": "313.4700",
                "2. high": "313.7300",
                "3. low": "313.0400",
                "4. close": "313.0650",
                "5. volume": "16207"
            },
            "2022-01-19 14:35:00": {
                "1. open": "313.0600",
                "2. high": "313.6600",
                "3. low": "313.0300",
                "4. close": "313.4450",
                "5. volume": "20611"
            },
            "2022-01-19 14:30:00": {
                "1. open": "313.2700",
                "2. high": "313.3300",
                "3. low": "313.0100",
                "4. close": "313.1000",
                "5. volume": "17335"
            },
            "2022-01-19 14:25:00": {
                "1. open": "313.2500",
                "2. high": "313.3700",
                "3. low": "312.8200",
                "4. close": "313.3700",
                "5. volume": "13903"
            },
            "2022-01-19 14:20:00": {
                "1. open": "313.2000",
                "2. high": "313.4700",
                "3. low": "312.8800",
                "4. close": "313.2500",
                "5. volume": "16568"
            },
            "2022-01-19 14:15:00": {
                "1. open": "313.2800",
                "2. high": "313.4650",
                "3. low": "312.8900",
                "4. close": "313.0900",
                "5. volume": "18629"
            },
            "2022-01-19 14:10:00": {
                "1. open": "313.1450",
                "2. high": "313.1450",
                "3. low": "312.4000",
                "4. close": "313.0950",
                "5. volume": "14928"
            },
            "2022-01-19 14:05:00": {
                "1. open": "313.3500",
                "2. high": "313.5800",
                "3. low": "312.9500",
                "4. close": "313.1400",
                "5. volume": "18504"
            },
            "2022-01-19 14:00:00": {
                "1. open": "313.7100",
                "2. high": "313.9100",
                "3. low": "313.2400",
                "4. close": "313.4400",
                "5. volume": "10982"
            },
            "2022-01-19 13:55:00": {
                "1. open": "313.5500",
                "2. high": "313.7600",
                "3. low": "313.2300",
                "4. close": "313.7600",
                "5. volume": "9612"
            },
            "2022-01-19 13:50:00": {
                "1. open": "313.5300",
                "2. high": "313.7800",
                "3. low": "313.0000",
                "4. close": "313.5900",
                "5. volume": "11450"
            },
            "2022-01-19 13:45:00": {
                "1. open": "312.9000",
                "2. high": "313.6000",
                "3. low": "312.9000",
                "4. close": "313.5300",
                "5. volume": "11110"
            },
            "2022-01-19 13:40:00": {
                "1. open": "313.4900",
                "2. high": "313.4900",
                "3. low": "312.4900",
                "4. close": "312.9100",
                "5. volume": "34799"
            },
            "2022-01-19 13:35:00": {
                "1. open": "314.1100",
                "2. high": "314.2300",
                "3. low": "313.4900",
                "4. close": "313.5000",
                "5. volume": "14296"
            },
            "2022-01-19 13:30:00": {
                "1. open": "314.5200",
                "2. high": "314.6200",
                "3. low": "313.9500",
                "4. close": "314.0700",
                "5. volume": "9675"
            },
            "2022-01-19 13:25:00": {
                "1. open": "314.2600",
                "2. high": "314.9700",
                "3. low": "314.1600",
                "4. close": "314.3950",
                "5. volume": "8648"
            },
            "2022-01-19 13:20:00": {
                "1. open": "314.8000",
                "2. high": "314.8600",
                "3. low": "314.2000",
                "4. close": "314.4300",
                "5. volume": "14991"
            },
            "2022-01-19 13:15:00": {
                "1. open": "314.9000",
                "2. high": "315.0600",
                "3. low": "314.8000",
                "4. close": "314.9800",
                "5. volume": "7705"
            },
            "2022-01-19 13:10:00": {
                "1. open": "315.3650",
                "2. high": "315.4100",
                "3. low": "314.6800",
                "4. close": "314.7400",
                "5. volume": "14598"
            },
            "2022-01-19 13:05:00": {
                "1. open": "315.5000",
                "2. high": "315.5150",
                "3. low": "315.1050",
                "4. close": "315.4000",
                "5. volume": "14055"
            },
            "2022-01-19 13:00:00": {
                "1. open": "315.2100",
                "2. high": "315.9700",
                "3. low": "315.2100",
                "4. close": "315.6300",
                "5. volume": "10957"
            },
            "2022-01-19 12:55:00": {
                "1. open": "315.2400",
                "2. high": "315.5200",
                "3. low": "315.0700",
                "4. close": "315.1050",
                "5. volume": "11620"
            },
            "2022-01-19 12:50:00": {
                "1. open": "315.1550",
                "2. high": "315.8300",
                "3. low": "315.1100",
                "4. close": "315.1900",
                "5. volume": "15079"
            },
            "2022-01-19 12:45:00": {
                "1. open": "315.2800",
                "2. high": "315.3700",
                "3. low": "314.8600",
                "4. close": "315.1500",
                "5. volume": "10950"
            },
            "2022-01-19 12:40:00": {
                "1. open": "314.7900",
                "2. high": "315.4500",
                "3. low": "314.7500",
                "4. close": "315.2200",
                "5. volume": "6595"
            },
            "2022-01-19 12:35:00": {
                "1. open": "315.3350",
                "2. high": "315.5700",
                "3. low": "314.7800",
                "4. close": "314.7800",
                "5. volume": "25624"
            },
            "2022-01-19 12:30:00": {
                "1. open": "315.4500",
                "2. high": "315.6200",
                "3. low": "314.7800",
                "4. close": "315.2700",
                "5. volume": "29577"
            },
            "2022-01-19 12:25:00": {
                "1. open": "315.7400",
                "2. high": "316.0000",
                "3. low": "315.3700",
                "4. close": "315.5600",
                "5. volume": "17225"
            },
            "2022-01-19 12:20:00": {
                "1. open": "316.2800",
                "2. high": "316.3700",
                "3. low": "315.7400",
                "4. close": "315.8500",
                "5. volume": "15786"
            },
            "2022-01-19 12:15:00": {
                "1. open": "315.0550",
                "2. high": "316.4100",
                "3. low": "315.0550",
                "4. close": "316.2100",
                "5. volume": "24569"
            },
            "2022-01-19 12:10:00": {
                "1. open": "315.0050",
                "2. high": "315.2600",
                "3. low": "314.7700",
                "4. close": "315.0100",
                "5. volume": "21329"
            },
            "2022-01-19 12:05:00": {
                "1. open": "315.3200",
                "2. high": "315.4250",
                "3. low": "314.6600",
                "4. close": "315.0000",
                "5. volume": "33725"
            },
            "2022-01-19 12:00:00": {
                "1. open": "315.1680",
                "2. high": "315.7000",
                "3. low": "315.1000",
                "4. close": "315.4900",
                "5. volume": "31210"
            },
            "2022-01-19 11:55:00": {
                "1. open": "314.7400",
                "2. high": "315.2200",
                "3. low": "314.1650",
                "4. close": "315.1000",
                "5. volume": "17826"
            },
            "2022-01-19 11:50:00": {
                "1. open": "314.6000",
                "2. high": "314.9700",
                "3. low": "314.0000",
                "4. close": "314.6600",
                "5. volume": "58772"
            },
            "2022-01-19 11:45:00": {
                "1. open": "314.5200",
                "2. high": "314.7400",
                "3. low": "313.8600",
                "4. close": "314.5400",
                "5. volume": "11072"
            },
            "2022-01-19 11:40:00": {
                "1. open": "314.1300",
                "2. high": "314.6050",
                "3. low": "313.8750",
                "4. close": "314.4700",
                "5. volume": "7125"
            },
            "2022-01-19 11:35:00": {
                "1. open": "314.6500",
                "2. high": "315.0550",
                "3. low": "313.5300",
                "4. close": "314.0000",
                "5. volume": "17098"
            },
            "2022-01-19 11:30:00": {
                "1. open": "314.2400",
                "2. high": "314.6900",
                "3. low": "313.5800",
                "4. close": "314.5100",
                "5. volume": "15444"
            },
            "2022-01-19 11:25:00": {
                "1. open": "314.6600",
                "2. high": "314.7050",
                "3. low": "313.8600",
                "4. close": "314.1700",
                "5. volume": "14495"
            },
            "2022-01-19 11:20:00": {
                "1. open": "313.5700",
                "2. high": "314.5400",
                "3. low": "313.4300",
                "4. close": "314.5400",
                "5. volume": "11143"
            },
            "2022-01-19 11:15:00": {
                "1. open": "314.6500",
                "2. high": "314.7200",
                "3. low": "313.3800",
                "4. close": "313.7500",
                "5. volume": "21327"
            },
            "2022-01-19 11:10:00": {
                "1. open": "315.4550",
                "2. high": "315.4700",
                "3. low": "314.7100",
                "4. close": "314.7100",
                "5. volume": "15451"
            },
            "2022-01-19 11:05:00": {
                "1. open": "315.1300",
                "2. high": "315.7300",
                "3. low": "314.8350",
                "4. close": "315.4740",
                "5. volume": "25077"
            },
            "2022-01-19 11:00:00": {
                "1. open": "315.9000",
                "2. high": "315.9150",
                "3. low": "314.6800",
                "4. close": "315.2700",
                "5. volume": "24513"
            },
            "2022-01-19 10:55:00": {
                "1. open": "314.9600",
                "2. high": "316.0000",
                "3. low": "314.6800",
                "4. close": "315.8950",
                "5. volume": "32601"
            },
            "2022-01-19 10:50:00": {
                "1. open": "316.2100",
                "2. high": "316.4200",
                "3. low": "314.7600",
                "4. close": "314.8950",
                "5. volume": "27999"
            },
            "2022-01-19 10:45:00": {
                "1. open": "316.2000",
                "2. high": "316.8100",
                "3. low": "315.8400",
                "4. close": "316.1000",
                "5. volume": "22562"
            },
            "2022-01-19 10:40:00": {
                "1. open": "315.2200",
                "2. high": "316.7900",
                "3. low": "315.2200",
                "4. close": "316.3300",
                "5. volume": "25158"
            },
            "2022-01-19 10:35:00": {
                "1. open": "314.3000",
                "2. high": "315.2300",
                "3. low": "314.1010",
                "4. close": "315.2200",
                "5. volume": "26615"
            },
            "2022-01-19 10:30:00": {
                "1. open": "316.2300",
                "2. high": "316.2300",
                "3. low": "314.0700",
                "4. close": "314.1800",
                "5. volume": "27299"
            },
            "2022-01-19 10:25:00": {
                "1. open": "316.8650",
                "2. high": "316.8800",
                "3. low": "316.3800",
                "4. close": "316.3900",
                "5. volume": "12160"
            },
            "2022-01-19 10:20:00": {
                "1. open": "317.6900",
                "2. high": "317.9700",
                "3. low": "316.7400",
                "4. close": "316.9000",
                "5. volume": "12638"
            },
            "2022-01-19 10:15:00": {
                "1. open": "316.9900",
                "2. high": "317.5700",
                "3. low": "316.8150",
                "4. close": "317.5500",
                "5. volume": "15263"
            },
            "2022-01-19 10:10:00": {
                "1. open": "317.4850",
                "2. high": "317.5300",
                "3. low": "316.3800",
                "4. close": "317.0000",
                "5. volume": "11717"
            },
            "2022-01-19 10:05:00": {
                "1. open": "318.9100",
                "2. high": "318.9100",
                "3. low": "317.0000",
                "4. close": "317.5450",
                "5. volume": "15418"
            },
            "2022-01-19 10:00:00": {
                "1. open": "318.4900",
                "2. high": "318.8900",
                "3. low": "318.0100",
                "4. close": "318.5950",
                "5. volume": "16676"
            },
            "2022-01-19 09:55:00": {
                "1. open": "317.9000",
                "2. high": "319.0700",
                "3. low": "317.8000",
                "4. close": "318.3900",
                "5. volume": "13886"
            },
            "2022-01-19 09:50:00": {
                "1. open": "316.8750",
                "2. high": "318.6550",
                "3. low": "316.7850",
                "4. close": "318.0850",
                "5. volume": "19279"
            },
            "2022-01-19 09:45:00": {
                "1. open": "316.4300",
                "2. high": "316.8850",
                "3. low": "315.4800",
                "4. close": "316.4500",
                "5. volume": "16035"
            },
            "2022-01-19 09:40:00": {
                "1. open": "315.2200",
                "2. high": "316.7550",
                "3. low": "314.8100",
                "4. close": "316.7450",
                "5. volume": "28649"
            },
            "2022-01-19 09:35:00": {
                "1. open": "314.8900",
                "2. high": "315.6600",
                "3. low": "312.0800",
                "4. close": "315.1900",
                "5. volume": "45207"
            },
            "2022-01-19 07:05:00": {
                "1. open": "313.7000",
                "2. high": "313.7000",
                "3. low": "313.7000",
                "4. close": "313.7000",
                "5. volume": "140"
            },
            "2022-01-18 16:05:00": {
                "1. open": "310.9500",
                "2. high": "310.9500",
                "3. low": "310.9500",
                "4. close": "310.9500",
                "5. volume": "159882"
            },
            "2022-01-18 16:00:00": {
                "1. open": "309.5200",
                "2. high": "311.1500",
                "3. low": "309.4200",
                "4. close": "310.9600",
                "5. volume": "210247"
            },
            "2022-01-18 15:55:00": {
                "1. open": "310.1000",
                "2. high": "310.4700",
                "3. low": "309.4500",
                "4. close": "309.5100",
                "5. volume": "79067"
            },
            "2022-01-18 15:50:00": {
                "1. open": "309.8200",
                "2. high": "310.3200",
                "3. low": "309.7500",
                "4. close": "309.9950",
                "5. volume": "51505"
            },
            "2022-01-18 15:45:00": {
                "1. open": "310.7100",
                "2. high": "310.7100",
                "3. low": "309.7200",
                "4. close": "309.8200",
                "5. volume": "41686"
            },
            "2022-01-18 15:40:00": {
                "1. open": "310.8600",
                "2. high": "310.9300",
                "3. low": "310.4700",
                "4. close": "310.7600",
                "5. volume": "32347"
            },
            "2022-01-18 15:35:00": {
                "1. open": "310.4800",
                "2. high": "311.1950",
                "3. low": "310.2850",
                "4. close": "310.7800",
                "5. volume": "30757"
            },
            "2022-01-18 15:30:00": {
                "1. open": "310.1100",
                "2. high": "310.4700",
                "3. low": "309.8600",
                "4. close": "310.4250",
                "5. volume": "21309"
            },
            "2022-01-18 15:25:00": {
                "1. open": "309.9100",
                "2. high": "310.2100",
                "3. low": "309.8600",
                "4. close": "310.1600",
                "5. volume": "17256"
            },
            "2022-01-18 15:20:00": {
                "1. open": "310.7400",
                "2. high": "310.7400",
                "3. low": "309.9200",
                "4. close": "310.0500",
                "5. volume": "26414"
            },
            "2022-01-18 15:15:00": {
                "1. open": "310.6500",
                "2. high": "311.0700",
                "3. low": "310.6200",
                "4. close": "310.8150",
                "5. volume": "16416"
            },
            "2022-01-18 15:10:00": {
                "1. open": "311.1800",
                "2. high": "311.2800",
                "3. low": "310.6700",
                "4. close": "310.7280",
                "5. volume": "16327"
            },
            "2022-01-18 15:05:00": {
                "1. open": "311.5400",
                "2. high": "311.7400",
                "3. low": "310.9500",
                "4. close": "311.0200",
                "5. volume": "16971"
            },
            "2022-01-18 15:00:00": {
                "1. open": "311.9100",
                "2. high": "312.0400",
                "3. low": "311.5900",
                "4. close": "311.5900",
                "5. volume": "16253"
            },
            "2022-01-18 14:55:00": {
                "1. open": "311.7300",
                "2. high": "312.0900",
                "3. low": "311.7200",
                "4. close": "311.8700",
                "5. volume": "10931"
            }
        }
    }
    const keys = Object.keys(data[TIME_SERIES_5MIN]).reverse();
    const values = Object.values(data[TIME_SERIES_5MIN]).reverse();
    const dataset = Object.entries(data[TIME_SERIES_5MIN])
        // .filter(([k]) => k.startsWith('2022-01-19'))
        .reverse();

    let chartLabels = dataset.map(([k]) => k).map(time => time.slice(10, 16));
    let chartValues = values.map(v => v['4. close']);

    let newData = Object.entries(data[TIME_SERIES_5MIN]).reduce(
        (prev, [k, v]) => ({[k.replace(' ', 'T')]: v['4. close'], ...prev}), {});
    // let newData = Object.entries(data[TIME_SERIES_5MIN]).reduce(
    //     (prev, [k, v]) => ([{x: k.replace(' ', 'T'), y: v['4. close']}, ...prev]), []);
    console.log(newData);

    // onMount(async (promise) => {
    //     ctx = chartCanvas.getContext('2d');
    //     var chart = new chartjs(ctx, {
    //         type: 'line',
    //         data: {
    //             labels: chartLabels,
    //             datasets: [{
    //                 label: 'Revenue',
    //                 backgroundColor: 'rgb(255, 99, 132)',
    //                 borderColor: 'rgb(255, 99, 132)',
    //                 data: chartValues
    //             }]
    //         }
    //     });
    //
    // });

</script>

<Line data={ {
    datasets: [{
        label: 'Price',
        backgroundColor: 'rgb(255, 99, 132)',
        borderColor: 'rgb(255, 99, 132)',
        data: newData
}]}}
      options={{
            scales: {
                x: {
                    type: 'time',
                    time: {
                        displayFormats: {
                            hour: 'hh:mm'
                        }
                    }
                }
            }
        }}
/>
